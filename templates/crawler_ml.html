<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>金融爬虫 + MySQL + 机器学习综合实验</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="bg-light">
    <div class="container py-3">
      <h3 class="mb-3 text-center">
        金融爬虫 + MySQL + 机器学习综合实验（示例系统）
      </h3>
      <p class="text-muted small mb-3 text-center">
        通过前端控件输入关键字或接口地址，从不同网站获取金融数据，保存到 MySQL，再使用回归、分类、聚类三类机器学习算法完成预测。
      </p>

      <!-- 一、爬取金融新闻 -->
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">一、抓取金融新闻数据</h5>
          <div class="row g-2 align-items-end">
            <div class="col-md-4">
              <label class="form-label">新闻搜索关键字</label>
              <input
                type="text"
                class="form-control"
                id="newsKeyword"
                placeholder="例如：股票 / 利率 / 美联储"
              />
            </div>
            <div class="col-md-4">
              <label class="form-label">保存到 MySQL 的表名</label>
              <input
                type="text"
                class="form-control"
                id="newsTable"
                value="news_data"
              />
            </div>
            <div class="col-md-4">
              <button class="btn btn-primary w-100" id="btnCrawlNews">
                爬取新闻并保存
              </button>
            </div>
          </div>
          <small class="text-muted"
            >提示：本示例使用简单爬虫流程演示，实际运行时请根据课程要求选择合法的数据源并调整解析规则。</small
          >
          <pre
            id="newsResult"
            class="mt-2 bg-dark text-light p-2 small"
            style="max-height: 180px; overflow: auto"
          ></pre>
        </div>
      </div>

      <!-- 二、爬取价格时间序列 -->
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">二、抓取价格时间序列数据</h5>
          <div class="row g-2 align-items-end">
            <div class="col-md-6">
              <label class="form-label">返回 JSON 的金融接口地址</label>
              <input
                type="text"
                class="form-control"
                id="priceApiUrl"
                placeholder="例如：某只股票历史价格 JSON 接口地址"
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">保存到 MySQL 的表名</label>
              <input
                type="text"
                class="form-control"
                id="priceTable"
                value="financial_series"
              />
            </div>
            <div class="col-md-3">
              <button class="btn btn-success w-100" id="btnCrawlPrice">
                爬取价格并保存
              </button>
            </div>
          </div>
          <small class="text-muted"
            >提示：接口返回格式示例 {"data":[{"date":"2024-01-01","price":10.2}, ...]}，可根据实际情况在
            Python 代码中调整解析。</small
          >
          <pre
            id="priceResult"
            class="mt-2 bg-dark text-light p-2 small"
            style="max-height: 180px; overflow: auto"
          ></pre>
        </div>
      </div>

      <!-- 三、从 MySQL 读取数据并运行三类机器学习算法 -->
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">三、MySQL 数据 + 三类机器学习预测</h5>
          <div class="row g-2 align-items-end">
            <div class="col-md-3">
              <label class="form-label">MySQL 表名</label>
              <input
                type="text"
                class="form-control"
                id="mlTable"
                value="financial_series"
              />
            </div>
            <div class="col-md-5">
              <label class="form-label">特征列名（逗号分隔）</label>
              <input
                type="text"
                class="form-control"
                id="mlFeatures"
                placeholder="例如：open,high,low,volume"
              />
            </div>
            <div class="col-md-4">
              <label class="form-label">目标列名（供回归和分类使用）</label>
              <input
                type="text"
                class="form-control"
                id="mlTarget"
                placeholder="例如：close 或 return"
              />
            </div>
          </div>
          <div class="mt-2">
            <button class="btn btn-warning" id="btnRunML">
              运行回归 + 分类 + 聚类
            </button>
          </div>
          <pre
            id="mlResult"
            class="mt-2 bg-dark text-light p-2 small"
            style="max-height: 260px; overflow: auto"
          ></pre>
        </div>
      </div>

      <footer class="text-center text-muted small py-2">
        课程实验示例 &copy; 爬虫 + MySQL + 机器学习
      </footer>
    </div>

    <script>
      function pretty(obj) {
        return JSON.stringify(obj, null, 2);
      }

      // 爬取新闻
      document
        .getElementById("btnCrawlNews")
        .addEventListener("click", function () {
          const fd = new FormData();
          fd.append(
            "keyword",
            document.getElementById("newsKeyword").value
          );
          fd.append("table_name", document.getElementById("newsTable").value);

          fetch("/api/crawl_news", {
            method: "POST",
            body: fd,
          })
            .then((r) => r.json())
            .then((data) => {
              document.getElementById("newsResult").textContent = pretty(data);
            })
            .catch((e) => {
              document.getElementById("newsResult").textContent =
                "请求失败：" + e;
            });
        });

      // 爬取价格序列
      document
        .getElementById("btnCrawlPrice")
        .addEventListener("click", function () {
          const fd = new FormData();
          fd.append("api_url", document.getElementById("priceApiUrl").value);
          fd.append("table_name", document.getElementById("priceTable").value);

          fetch("/api/crawl_price", {
            method: "POST",
            body: fd,
          })
            .then((r) => r.json())
            .then((data) => {
              document.getElementById("priceResult").textContent = pretty(data);
            })
            .catch((e) => {
              document.getElementById("priceResult").textContent =
                "请求失败：" + e;
            });
        });

      // 运行三类机器学习
      document
        .getElementById("btnRunML")
        .addEventListener("click", function () {
          const fd = new FormData();
          fd.append("table_name", document.getElementById("mlTable").value);
          fd.append("feature_cols", document.getElementById("mlFeatures").value);
          fd.append("target_col", document.getElementById("mlTarget").value);

          fetch("/api/run_ml", {
            method: "POST",
            body: fd,
          })
            .then((r) => r.json())
            .then((data) => {
              document.getElementById("mlResult").textContent = pretty(data);
            })
            .catch((e) => {
              document.getElementById("mlResult").textContent =
                "请求失败：" + e;
            });
        });
    </script>
  </body>
</html>


