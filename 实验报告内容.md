# 实验报告内容

## 二、问题描述和设计思路

### 问题描述：

本实验设计并实现了一个**金融数据与文献分析一体化系统**，该系统能够从多个数据源（TuShare、Alpha Vantage、东方财富、新浪财经等）爬取不同类型的金融数据，包括股票指数行情、外汇汇率、金融新闻快讯等。系统对爬取的数据进行清洗和预处理后，存储到MySQL数据库中。用户可以通过前端界面选择不同的数据表和特征列，系统会自动应用三类机器学习算法（线性回归、逻辑回归分类、KMeans聚类）进行数据分析和预测，并将结果以可视化的方式展示给用户。

### 设计思路：

**（1）数据爬取模块设计**
- 使用 `requests` 库和 `BeautifulSoup` 从东方财富网爬取金融新闻标题和链接
- 通过 TuShare API 爬取中国主要股票指数（上证指数、深证成指、创业板指、沪深300、中证500）的日线行情数据
- 调用 Alpha Vantage API 获取外汇汇率数据（USD/CNY、USD/GBP、USD/JPY、USD/EUR）
- 从新浪财经、东方财富等网站爬取金融快讯数据，支持关键词搜索和日期范围筛选
- 所有爬取的数据经过初步清洗（去重、去噪、格式统一）后准备入库

**（2）数据库存储与数据清洗模块设计**
- 使用 MySQL 作为数据存储后端，通过 SQLAlchemy 实现 ORM 映射和连接池管理
- 设计多个数据表结构：`ts_index_daily`（指数日线）、`fx_usdcny`、`fx_usdgbp`、`fx_usdjpy`、`fx_usdeur`（外汇数据）、`ts_flash`（快讯）、`ts_stock_daily`（个股日线）等
- 实现数据清洗功能：缺失值处理、数据类型转换、异常值检测、数据标准化
- 使用 `pandas` 进行数据预处理，包括特征工程（如计算收益率、涨跌幅等衍生指标）

**（3）机器学习算法模块设计**
- **回归算法**：使用 `sklearn.linear_model.LinearRegression` 实现线性回归，用于预测连续型目标变量（如股价、收益率），评估指标包括 R² 和均方误差
- **分类算法**：使用 `sklearn.linear_model.LogisticRegression` 实现逻辑回归二分类，将连续目标变量按中位数离散化为"高/低"两类，评估指标为准确率
- **聚类算法**：使用 `sklearn.cluster.KMeans` 实现K均值聚类，对金融数据进行无监督分群（如股票分组、客户分群），默认聚类数为3，使用标准化后的特征进行聚类
- 所有算法均采用训练集/测试集划分（7:3），使用 `StandardScaler` 进行特征标准化，确保不同量纲的特征具有可比性

**（4）前后端交互设计**
- 后端使用 Flask 框架提供 RESTful API，前端使用 HTML/JavaScript + Bootstrap + ECharts 构建交互界面
- 前端通过表单控件输入爬虫参数（关键词、数据源、日期范围等），后端返回 JSON 格式的数据和模型结果
- 使用 ECharts 实现多种图表可视化：折线图（指数走势）、柱状图（涨跌幅对比）、饼图（分类占比）、散点图（相关性分析）、箱线图（分布特征）
- 支持分析结果导出为 CSV、JSON、TXT 文本报告以及 PNG 静态图像

**（5）系统容错与性能优化**
- 实现多层容错机制：外部API调用失败时自动回退到数据库缓存或示例数据
- 数据库写入失败不影响前端展示，仅记录警告日志
- 使用连接池技术提高数据库访问性能，设置合理的超时和重试机制
- 对TuShare API调用实现退避重试策略，避免频率限制导致的失败

---

## 三、代码实现说明

### 主要模块文件：

1. **app.py**（2880行）- Flask 后端主程序，包含所有API路由和数据爬取逻辑
2. **crawler_ml.py**（328行）- 爬虫和机器学习核心模块
3. **analysis.py**（321行）- 数据分析和可视化数据生成模块
4. **ai_helper.py** - AI大模型调用封装（情感分析、文本摘要）
5. **utils.py** - 工具函数（错误处理、日志记录、数据验证）
6. **db_config.py** - 数据库配置
7. **templates/index.html** - 前端HTML模板

### 代码特点：

✅ **模块注释**：每个模块文件开头都有详细的模块功能说明和作者信息  
✅ **函数功能注释**：每个函数都有 docstring，说明函数功能、参数和返回值  
✅ **行注释**：关键代码行都有中文注释，解释业务逻辑和技术实现

### 关键技术点：

1. **网络爬虫**：`requests` + `BeautifulSoup` + `Selenium`（动态网页）
2. **数据库**：`pymysql` + `SQLAlchemy`（ORM + 连接池）
3. **数据处理**：`pandas` + `numpy`（数据清洗、特征工程）
4. **机器学习**：`sklearn`（LinearRegression、LogisticRegression、KMeans）
5. **Web框架**：`Flask`（后端API）+ `ECharts`（前端可视化）

---

## 补充说明

### 数据源说明：

1. **TuShare（聚宽数据）**：股票指数、个股日线、快讯数据
2. **Alpha Vantage**：外汇汇率数据
3. **东方财富网**：金融新闻、快讯
4. **新浪财经**：金融快讯

### 机器学习应用场景：

- **回归**：预测股票收盘价、指数点位、汇率走势
- **分类**：判断股票涨跌方向、收益率高低分类
- **聚类**：股票分组、客户分群、市场状态识别

### 系统运行流程：

```
用户输入参数 → 前端发送请求 → Flask后端接收
    ↓
调用爬虫函数 → 获取外部数据 → 数据清洗
    ↓
保存到MySQL → 从数据库读取 → 特征工程
    ↓
应用ML算法 → 计算评估指标 → 生成预测结果
    ↓
返回JSON数据 → 前端渲染图表 → 用户查看结果
```

---

**注意**：完整的代码文件已包含在项目中，所有代码均已添加模块注释、函数注释和行注释。请将代码文件打包上传。

